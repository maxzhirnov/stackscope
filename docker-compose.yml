version: "3.9"

services:
  web:
    image: "${STACKSCOPE_IMAGE:-maxzhirnov/stackscope}:latest"
    ports:
      - "3000:80"
    environment:
      RAILS_ENV: production
      RAILS_LOG_TO_STDOUT: "1"
      RAILS_SERVE_STATIC_FILES: "1"
      SECRET_KEY_BASE: "${SECRET_KEY_BASE}"
      RAILS_MASTER_KEY: "${RAILS_MASTER_KEY}"
      STACKSCOPE_ADMIN_USER: "${STACKSCOPE_ADMIN_USER}"
      STACKSCOPE_ADMIN_PASSWORD: "${STACKSCOPE_ADMIN_PASSWORD}"
    volumes:
      - stackscope_db:/rails/db
      - stackscope_storage:/rails/storage

  jobs:
    image: "${STACKSCOPE_IMAGE:-maxzhirnov/stackscope}:latest"
    command: ["./bin/jobs"]
    environment:
      RAILS_ENV: production
      RAILS_LOG_TO_STDOUT: "1"
      SECRET_KEY_BASE: "${SECRET_KEY_BASE}"
      RAILS_MASTER_KEY: "${RAILS_MASTER_KEY}"
      STACKSCOPE_ADMIN_USER: "${STACKSCOPE_ADMIN_USER}"
      STACKSCOPE_ADMIN_PASSWORD: "${STACKSCOPE_ADMIN_PASSWORD}"
    volumes:
      - stackscope_db:/rails/db
      - stackscope_storage:/rails/storage

volumes:
  stackscope_db:
  stackscope_storage:
